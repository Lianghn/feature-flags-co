
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.6">
    
    
      
        <title>Feature flags 技术让软件发布轻松不掉发 -  </title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2c0c5eaf.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7fa14f5b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="#443f5a" data-md-color-accent="#443f5a">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#feature-flags" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title=" " class="md-header__button md-logo" aria-label=" " data-md-component="logo">
      
  <img src="../../img/ff_logo+text_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
             
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Feature flags 技术让软件发布轻松不掉发
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      快速入门
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../sdk/c/" class="md-tabs__link">
        SDK
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../integration/azure/" class="md-tabs__link">
        云整合
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../feature-management/guide/" class="md-tabs__link">
        特征管理指南
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title=" " class="md-nav__button md-logo" aria-label=" " data-md-component="logo">
      
  <img src="../../img/ff_logo+text_white.png" alt="logo">

    </a>
     
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        快速入门
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        SDK
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="SDK" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          SDK
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sdk/c/" class="md-nav__link">
        C语言
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sdk/cURL/" class="md-nav__link">
        cURL
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sdk/csharp/" class="md-nav__link">
        CSharp
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sdk/Dart/" class="md-nav__link">
        Dart
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sdk/Go/" class="md-nav__link">
        Go
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sdk/HTTP/" class="md-nav__link">
        HTTP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sdk/Java/" class="md-nav__link">
        Java
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sdk/JavaScript/" class="md-nav__link">
        JavaScript
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sdk/NodeJs/" class="md-nav__link">
        NodeJs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sdk/Objective-C/" class="md-nav__link">
        Objective-C
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sdk/PHP/" class="md-nav__link">
        PHP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sdk/Python/" class="md-nav__link">
        Python
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sdk/Ruby/" class="md-nav__link">
        Ruby
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sdk/Swift/" class="md-nav__link">
        Swift
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        云整合
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="云整合" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          云整合
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/azure/" class="md-nav__link">
        微软Azure
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/aliyun/" class="md-nav__link">
        阿里云
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/aws/" class="md-nav__link">
        亚马逊AWS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/googlecloud/" class="md-nav__link">
        谷歌云
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/terraform/" class="md-nav__link">
        Terraform
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/jekins.md" class="md-nav__link">
        Jenkins
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        特征管理指南
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="特征管理指南" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          特征管理指南
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../feature-management/guide/" class="md-nav__link">
        特征管理的权威指南
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../feature-management/build/" class="md-nav__link">
        构建 Build (支柱一)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../feature-management/operate/" class="md-nav__link">
        运营 Operate (支柱二)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../feature-management/learn/" class="md-nav__link">
        学习 Learn (支柱三)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../feature-management/empower/" class="md-nav__link">
        赋能 Empower (支柱三)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../feature-management/vision/" class="md-nav__link">
        敏捷开关的视野
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#feature-flag" class="md-nav__link">
    什么是Feature flag？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feature-flags_1" class="md-nav__link">
    Feature Flags的性能指标
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    降低软件发布中的风险
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    百分比推广
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    用户定位
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    总结
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="feature-flags">Feature flags 技术让软件发布轻松不掉发</h1>
<p>我可以确定的一点是，所有曾经有过向客户发布软件经历的人都经历过这样的压力和焦虑：你祈祷着，希望在投入生产后一切都还会像测试时那样顺利。</p>
<p>如果你对这种情景感到很熟悉，那么我很高兴你能读到这篇文章，因为我将分享给你一种彻底消除这种痛苦的方法，而最棒的一点是这种方法并不复杂也不困难：它就是Feature Flags。</p>
<h2 id="feature-flag">什么是Feature flag？</h2>
<p>简而言之，可以把feature flag简单地视为一个包围你新功能代码的“if”语句。如果flag被设置为on，则执行新代码（即启用新功能），否则就不执行。真的就是这么简单！问题是，一旦开始使用feature flag，你很快就会发现，你会希望能够以一种更加精细的方式来控制它们，而不仅仅是打开或关闭这么粗放。</p>
<p><img alt="" src="/img/phase-features-with-ff-feature-flag.png" /></p>
<p>诸如feature-flags.co之类的功能管理平台填补了传统功能切换的空白。 它提供了一个简单的用户界面，强大的基础结构以及一整套功能，使您能够大规模使用功能标记。 而且，feature-flags.co支持多种复杂的用例-多元功能标记，用户细分，功能委派，A / B测试和实验等，所有这些都在一个平台上。 您可以获得功能标记的所有好处，而无需维护自己的本地功能标记管理系统的风险和开销。</p>
<p><img alt="" src="/img/phase-features-with-ff-ab-test.png" /></p>
<h2 id="feature-flags_1">Feature Flags的性能指标</h2>
<p>著名的DevOps研究和评估小组（DORA）提出了4个软件研发与交付的性能指标，Feature Flags专注于此而提高软件研发与交付的性能:</p>
<ul>
<li><code>部署和发布频率 (Deployment and release frequency)</code>, IBM使用Feature Flags从每周两次部署到生产，到每天超过100次。</li>
<li><code>变更所需的时间 (Lead time for changes)</code>,  2020年的一项调查显示，使用Feature Flags后，客户的变更准备时间减少了76％。</li>
<li><code>平均恢复服务时间 (Mean time to restore service)</code>, Trello，Confluence和Jira等流行软件产品的制造商Atlassian通过Feature Flags将其MTTR小时减少了97％。</li>
<li><code>变更失败率 (Change fail rate)</code>,  Feature Flags使Honeycomb能够保持0.1％的变更失败率，这一壮举使Honeycomb跻身精英之列。</li>
</ul>
<h2 id="_1">降低软件发布中的风险</h2>
<p>我敢肯定，到现在你已经可以猜到了：当代码中有一个feature flag的时候，我们就可以在部署该代码的时候不显示（不发布）某个功能了。我们可以通过feature-flags.co界面打开或关闭“推荐商品”组件，而无需重新部署应用程序。</p>
<p>然而，即使我们现在可以轻松地打开或关闭“推荐商品”组件，我们仍然面临着很高的风险，因为它要么是打开的要么就是关闭的，对所有客户都一样。这仍然不是非常理想，因为如果有问题，那么这个问题就能影响到每一个人。</p>
<p>Feature flag解决方案最强大的功能之一就是能够同时为不同用户打开或关闭每一个flag（每一个功能）。我们可以使用“百分比推广”和“用户定位”两种方法中的一种，就能在feature-flags.co中实现这个目标。这就是使用现成解决方案的最大优势，因为你能马上就获得这些开箱即用的功能。</p>
<h2 id="_2">百分比推广</h2>
<p>在feature-flags.co中，你能够以应用程序中用户的百分比为标志来设置不同的状态。在下面显示的这个例子中，我将“推荐商品”组件设置为：显示给10%的访问该网站的用户，而其他90％的用户看不到它。这就使得我可以轻松地用10％的随机用户群体来测试这个“推荐商品”组件。如果结果都像我预期的那样，那就可以慢慢增加能看到组件的用户百分比了。</p>
<p>通过这种做法，我可以逐渐看到我的应用程序对于新功能的反应是怎样的。如果检测到有任何问题，我都可以单击一下按钮就将其关闭。</p>
<h2 id="_3">用户定位</h2>
<p>对于“谁将看到新的推荐商品组件”，我们可以使用用户定位来实现在这一点上的非常精细的控制。用户定位用到了我们一开始在代码示例中设置的属性，我们可以使用这些属性来控制何人，以及何时能够看到组件。</p>
<p>在下面的例子里，我通过CountryCode属性设置了仅针对英国客户显示“推荐商品”组件。</p>
<p>有了用户定位，您可以创建多个规则，从而可以根据需要定位非常特定的用户子集。只要你有相关的用户数据并根据这些数据设置出feature-flags.co用户属性，就可以用它来将特定的flag定位到这些用户了。</p>
<h2 id="_4">总结</h2>
<p>通过使用feature flags，你可以完全地掌控哪些人能看到你的新功能，哪些人看不到，以及何时可以看到，而无需重新部署代码。通过仅对一小部分或少量目标用户启用新功能这种方法，可以大大降低发布功能过程中的风险。</p>
<p>如果你的功能不能正常运行，那么起码你知道它只影响到了你客户中的一小部分而不是整个客户群体。如果发现该功能出现异常并无法按你的预期运行，就可以很容易地关闭该功能。</p>
<p>如你所见，一旦开始学会使用feature flags，你可能会首先意识到幕后要做的事情有很多。因此，投资使用诸如feature-flags.co之类的feature flag即服务解决方案会是个好主意，而不是把时间和精力花费到内部开发feature flag解决方案上。</p>
<p>就像你会把支付处理这样的复杂活动外包出去一样，把相同的理念扩展到开发和部署工具也十分合理——这样就能使你更专注于最重要的核心业务了。</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 北京天博助力科技有限公司
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.tabs"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.a1c7c35e.min.js"></script>
      
    
  </body>
</html>